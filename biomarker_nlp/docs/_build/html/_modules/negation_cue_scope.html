

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>negation_cue_scope &mdash; Biomarker_NLP 0.0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Biomarker_NLP
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">biomarker_nlp</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Biomarker_NLP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>negation_cue_scope</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for negation_cue_scope</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#from biomarker_nlp.negation_negbert import *</span>

<div class="viewcode-block" id="negation_detect"><a class="viewcode-back" href="../negation_cue_scope.html#negation_cue_scope.negation_detect">[docs]</a><span class="k">def</span> <span class="nf">negation_detect</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">modelCue</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Detect if a sentence contains any negation cues.</span>

<span class="sd">  This function predicts if a sentence contains any negation words by using a pre-trained negation detection model that was pre-trained through Aditya and Suraj&#39;s (2020) NegBERT transfer learning program. </span>
<span class="sd">  Please see the reference link: https://github.com/adityak6798/Transformers-For-Negation-and-Speculation. The model was trained using &#39;bioscope_abstracts&#39; and &#39;bioscope_full_papers&#39; corpora. </span>
<span class="sd">  It was upload to a cloud repository and was freely available. </span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  text : str</span>
<span class="sd">      a single sentence. </span>

<span class="sd">  modelCue : torch model</span>
<span class="sd">      pre-trained negation cue detection model</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  bool</span>
<span class="sd">      True if any negation cues are detected. </span>
<span class="sd">      False if no negation cues are detected.</span>
<span class="sd">  </span>
<span class="sd">  See Also</span>
<span class="sd">  --------</span>
<span class="sd">  negation_scope</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  NVIDIA GPU will be required. Make sure your machine brings NVIDIA GPU or set GPU as Hardware accelerator if using Colab notebook.</span>
<span class="sd">  </span>
<span class="sd">  Examples</span>
<span class="sd">  --------</span>
<span class="sd">  Install the necessary packages, and make sure to turn the GPU Hardware accelerator on. </span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; If using Colab Notebook, use !pip instead pip.</span>
<span class="sd">  $ pip install biomarker_nlp</span>
<span class="sd">  $ pip install transformers</span>
<span class="sd">  $ pip install knockknock==0.1.7</span>
<span class="sd">  $ pip install sentencepiece</span>
<span class="sd">  </span>
<span class="sd">  Load the necessary packages and pre-trained model</span>

<span class="sd">  &gt;&gt;&gt; from biomarker_nlp import negation_cue_scope</span>
<span class="sd">  &gt;&gt;&gt; from biomarker_nlp.negation_negbert import * # This code MUST be run before loading the pre-trained negation models</span>
<span class="sd">  &gt;&gt;&gt; modelCue = torch.load(&#39;/path/to/negation/cue/detection/model&#39;) # path to the location where the model file is placed</span>
<span class="sd"> </span>
<span class="sd">  </span>
<span class="sd">  Examples (predict negation)</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; txt = &quot;TECENTRIQ is not indicated for use in combination with paclitaxel for the treatment of adult patients with unresectable locally advanced or metastatic TNBC.&quot;</span>
<span class="sd">  &gt;&gt;&gt; negation_cue_scope.negation_detect(text = txt, modelCue = modelCue)</span>
<span class="sd">  True</span>
<span class="sd">  &gt;&gt;&gt; txt = &quot;KEYTRUDA is not recommended for treatment of patients with PMBCL who require urgent cytoreductive therapy.&quot;</span>
<span class="sd">  &gt;&gt;&gt; negation_cue_scope.negation_detect(text = txt, modelCue = modelCue)</span>
<span class="sd">  True</span>
<span class="sd">  &gt;&gt;&gt; txt = &quot;KEYTRUDA is indicated for the treatment of adult patients with relapsed or refractory classical Hodgkin lymphoma (cHL).&quot;</span>
<span class="sd">  &gt;&gt;&gt; negation_cue_scope.negation_detect(text = txt, modelCue = modelCue)</span>
<span class="sd">  False</span>

<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># perform negation cue detection</span>
  <span class="n">mydata</span> <span class="o">=</span> <span class="n">CustomData</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
  <span class="n">dl</span> <span class="o">=</span> <span class="n">mydata</span><span class="o">.</span><span class="n">get_cue_dataloader</span><span class="p">()</span>
  <span class="n">cueIndex</span> <span class="o">=</span> <span class="n">modelCue</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>

  <span class="c1"># check if negation is detected</span>
  <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">cueIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
    <span class="k">return</span> <span class="kc">True</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="negation_scope"><a class="viewcode-back" href="../negation_cue_scope.html#negation_cue_scope.negation_scope">[docs]</a><span class="k">def</span> <span class="nf">negation_scope</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">modelCue</span><span class="p">,</span> <span class="n">modelScope</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Extract the scope of negation in a sentence.</span>

<span class="sd">  This function predicts the negation cues and their scope in a sentence by using two pre-trained negation models that were pre-trained through Aditya and Suraj&#39;s (2020) NegBERT transfer learning program. </span>
<span class="sd">  Please see the reference link: https://github.com/adityak6798/Transformers-For-Negation-and-Speculation. The models were trained using &#39;bioscope_abstracts&#39; and &#39;bioscope_full_papers&#39; corpora.</span>
<span class="sd">  One of them is used to performed negation cue detection and negation scope resolution. Another one is used to performed negation scope resolution. They were upload to a cloud repository and were freely available. </span>
<span class="sd">  This function predicts negation cues first through the negation cue detection model. If any negation cues were predicted, it predicts the scope of each negation cue, if there are more than one, through the negation scope resolution model.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  text : str</span>
<span class="sd">      a single sentence.</span>

<span class="sd">  modelCue : torch model</span>
<span class="sd">      pre-trained negation cue prediction model</span>

<span class="sd">  modelScopre : torch model</span>
<span class="sd">      pre-trained negation scope prediction model</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  list</span>
<span class="sd">      a list of negated clauses. Some sentences would contain more than one negation cue, in this case, all of their negated clauses will be extracted. If no negation is found, return an empty list.</span>
<span class="sd">  </span>
<span class="sd">  See Also</span>
<span class="sd">  --------</span>
<span class="sd">  negation_detect</span>
<span class="sd">  </span>
<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  The negation cue will not be extracted.</span>
<span class="sd">  NVIDIA GPU will be required. Make sure your machine brings NVIDIA GPU or set GPU as Hardware accelerator if using Colab notebook.</span>
<span class="sd">  </span>
<span class="sd">  Examples</span>
<span class="sd">  --------</span>
<span class="sd">  Install the necessary packages, and make sure to turn the GPU Hardware accelerator on. </span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; If using Colab Notebook, use !pip instead pip.</span>
<span class="sd">  $ pip install biomarker_nlp</span>
<span class="sd">  $ pip install transformers</span>
<span class="sd">  $ pip install knockknock==0.1.7</span>
<span class="sd">  $ pip install sentencepiece</span>
<span class="sd">  </span>
<span class="sd">  Load the necessary packages and pre-trained model</span>

<span class="sd">  &gt;&gt;&gt; from biomarker_nlp import negation_cue_scope</span>
<span class="sd">  &gt;&gt;&gt; from biomarker_nlp.negation_negbert import * # This code MUST be run before loading the pre-trained negation models</span>
<span class="sd">  &gt;&gt;&gt; modelCue = torch.load(&#39;/path/to/negation/cue/detection/model&#39;) # path to the location where the model file is placed</span>
<span class="sd">  &gt;&gt;&gt; modelScope = torch.load(&#39;/path/to/negation/scope/detection/model&#39;) # path to the location where the model file is placed</span>
<span class="sd">  </span>
<span class="sd">  Examples (predict negation scope)</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; txt = &quot;TECENTRIQ is not indicated for use in combination with paclitaxel for the treatment of adult patients with unresectable locally advanced or metastatic TNBC.&quot;</span>
<span class="sd">  &gt;&gt;&gt; negation_cue_scope.negation_scope(text = txt, modelCue = modelCue, modelScope = modelScope)</span>
<span class="sd">  [&#39;TECENTRIQ is&#39;, &#39;indicated for use in combination with paclitaxel for&#39;]</span>
<span class="sd">  &gt;&gt;&gt; txt = &quot;KEYTRUDA is not recommended for treatment of patients with PMBCL who require urgent cytoreductive therapy.&quot;</span>
<span class="sd">  &gt;&gt;&gt; negation_cue_scope.negation_scope(text = txt, modelCue = modelCue, modelScope = modelScope)</span>
<span class="sd">  [&#39;KEYTRUDA is&#39;, &#39;recommended for treatment of patients with PMBCL who&#39;]</span>

<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># perform negation cue detection</span>
  <span class="n">mydata</span> <span class="o">=</span> <span class="n">CustomData</span><span class="p">([</span><span class="n">text</span><span class="p">])</span>
  <span class="n">dl</span> <span class="o">=</span> <span class="n">mydata</span><span class="o">.</span><span class="n">get_cue_dataloader</span><span class="p">()</span>
  <span class="n">cueIndex</span> <span class="o">=</span> <span class="n">modelCue</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>

  <span class="c1"># string of the scope</span>
  <span class="n">negationScope</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="c1"># check if negation is detected.</span>
  <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">cueIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
    
    <span class="c1"># perform negation scope resolution</span>
    <span class="n">mydata</span> <span class="o">=</span> <span class="n">CustomData</span><span class="p">([</span><span class="n">text</span><span class="p">],</span> <span class="n">cues</span> <span class="o">=</span> <span class="n">cueIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dl</span> <span class="o">=</span> <span class="n">mydata</span><span class="o">.</span><span class="n">get_scope_dataloader</span><span class="p">()</span>
    <span class="n">scopeIndex</span> <span class="o">=</span> <span class="n">modelScope</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>

    <span class="c1"># extract the negated string of the scope</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scopeIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
      <span class="n">scopeSubstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())):</span>
        <span class="k">if</span> <span class="n">scopeIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">scopeSubstr</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">scopeIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">scopeSubstr</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">negationScope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scopeSubstr</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span> 
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scopeSubstr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">negationScope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scopeSubstr</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
            <span class="n">scopeSubstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  
  <span class="k">return</span> <span class="n">negationScope</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Junxia Lin, Yuezheng He, Subha Madhavan, Chul Kim, Simina M. Boca.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>